:80 {
    log
    
    # Debug endpoint to check API key
    handle /debug {
        respond "API_KEY: {$API_KEY}" 200
    }
    
    # Test if Caddy can reach any external site
    handle /test-external {
        reverse_proxy https://httpbin.org {
            uri strip_prefix /test-external /anything
        }
    }
    
    # Test direct call to socialsundae.io
    handle /test-direct {
        reverse_proxy https://socialsundae.io {
            uri strip_prefix /test-direct /api/metrics
            header_up X-API-Key {$API_KEY}
            header_up User-Agent "PostmanRuntime/7.32.3"
        }
    }
    
    reverse_proxy /api/metrics https://socialsundae.io {
        header_up X-API-Key {$API_KEY}
        header_up User-Agent "PostmanRuntime/7.32.3"
        header_up Accept "*/*"
        header_up Accept-Encoding "gzip, deflate, br"
        header_up Connection "keep-alive"
    }
} 